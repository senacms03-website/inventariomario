<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Contagem de Produtos</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- XLSX -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 1000px;
        }
        input, select, button {
            transition: all 0.2s;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center min-h-screen p-4">

    <div class="container bg-white p-6 rounded-xl shadow-lg mt-8 w-full mx-auto">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Contagem de Produtos Aula Prática / Prof.: Mário</h1>

        <!-- Seção Contagem -->
        <div id="contagem-section" class="tab-content">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700">Registro da Contagem</h2>
            <form id="contagem-form" class="space-y-4">
                <div>
                    <label for="codigo" class="block text-sm font-medium text-gray-700">Código do Produto</label>
                    <input type="text" id="codigo" name="codigo" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2">
                </div>
                <div>
                    <label for="nome-produto" class="block text-sm font-medium text-gray-700">Nome do Produto</label>
                    <input type="text" id="nome-produto" name="nomeProduto" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2">
                </div>
                <div>
                    <label for="descricao-produto" class="block text-sm font-medium text-gray-700">Descrição Detalhada</label>
                    <textarea id="descricao-produto" name="descricaoProduto" rows="3" required
                              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2"></textarea>
                </div>
                <div>
                    <label for="localizacao" class="block text-sm font-medium text-gray-700">Localização</label>
                    <input type="text" id="localizacao" name="localizacao" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2">
                </div>
                <div>
                    <label for="quantidade" class="block text-sm font-medium text-gray-700">Quantidade Contada</label>
                    <input type="number" id="quantidade" name="quantidade" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2">
                </div>
                <div class="flex space-x-2">
                    <button type="submit"
                            class="flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">
                        Salvar Contagem
                    </button>
                </div>
            </form>
            <hr class="my-6 border-gray-200">
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 space-y-2 sm:space-y-0">
                <h3 class="text-xl font-semibold text-gray-700">Minhas Contagens</h3>
                <div class="flex flex-col sm:flex-row sm:space-x-2 space-y-2 sm:space-y-0 w-full sm:w-auto">
                    <button id="exportar-contagem-xlsx"
                            class="w-full sm:w-auto py-2 px-4 rounded-md text-sm font-medium text-white bg-green-600 hover:bg-green-700">
                        Exportar (.xlsx)
                    </button>
                    <button id="exportar-contagem-pdf"
                            class="w-full sm:w-auto py-2 px-4 rounded-md text-sm font-medium text-white bg-red-600 hover:bg-red-700">
                        Exportar (.pdf)
                    </button>
                    <button id="limpar-minha-contagem"
                            class="w-full sm:w-auto py-2 px-4 rounded-md text-sm font-medium text-white bg-red-600 hover:bg-red-700">
                        Limpar Minha Contagem
                    </button>
                </div>
            </div>
            <div class="bg-white rounded-md shadow overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Código</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome do Produto</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Descrição</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Localização</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Quantidade</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="contagens-table-body" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>
        </div>
    </div>

    <footer class="w-full mt-8">
        <p class="text-center text-sm text-gray-500">© 2025 Prof. Mário - Todos os direitos reservados.</p>
    </footer>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center">
        <div class="relative p-5 border w-96 shadow-lg rounded-md bg-white">
            <h3 class="text-lg font-bold text-gray-900 mb-4">Confirmação</h3>
            <p class="text-sm text-gray-500 mb-6" id="modal-text"></p>
            <div class="flex justify-end space-x-4">
                <button id="modal-cancel-btn" class="px-4 py-2 bg-gray-200 rounded-md">Cancelar</button>
                <button id="modal-confirm-btn" class="px-4 py-2 bg-red-600 text-white rounded-md">Confirmar</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const contagemForm = document.getElementById('contagem-form');
            const contagensTableBody = document.getElementById('contagens-table-body');
            const exportarContagemXlsxBtn = document.getElementById('exportar-contagem-xlsx');
            const exportarContagemPdfBtn = document.getElementById('exportar-contagem-pdf');
            const limparMinhaContagemBtn = document.getElementById('limpar-minha-contagem');
            const modal = document.getElementById('modal');
            const modalConfirmBtn = document.getElementById('modal-confirm-btn');
            const modalCancelBtn = document.getElementById('modal-cancel-btn');
            const modalText = document.getElementById('modal-text');
            let contagens = JSON.parse(localStorage.getItem('minhasContagens')) || [];
            let modalAction = null;

            // Contador de exportações
            let exportCount = 0;

            // Função para gerar nome único
            function gerarNomeArquivo(extensao) {
                exportCount++;
                const agora = new Date();
                const dataHora = agora.toISOString().replace(/[-T:.Z]/g, "").slice(0,14);
                const randomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
                return `contagem_${exportCount}_${randomCode}_${dataHora}.${extensao}`;
            }

            function renderContagens() {
                contagensTableBody.innerHTML = '';
                contagens.forEach((item, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-6 py-4 text-sm text-gray-900">${item.codigo}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${item.nomeProduto}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${item.descricaoProduto}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${item.localizacao}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${item.quantidade}</td>
                        <td class="px-6 py-4 text-sm text-right"><button class="text-red-600 delete-btn" data-index="${index}">Remover</button></td>`;
                    contagensTableBody.appendChild(row);
                });
            }

            function clearUserContagens() {
                contagens = [];
                localStorage.removeItem('minhasContagens');
                renderContagens();
            }

            contagemForm.addEventListener('submit', e => {
                e.preventDefault();
                const codigo = document.getElementById('codigo').value;
                const nomeProduto = document.getElementById('nome-produto').value;
                const descricaoProduto = document.getElementById('descricao-produto').value;
                const localizacao = document.getElementById('localizacao').value;
                const quantidade = parseInt(document.getElementById('quantidade').value);
                contagens.push({ codigo, nomeProduto, descricaoProduto, localizacao, quantidade });
                localStorage.setItem('minhasContagens', JSON.stringify(contagens));
                renderContagens();
                contagemForm.reset();
            });

            contagensTableBody.addEventListener('click', e => {
                if (e.target.classList.contains('delete-btn')) {
                    const index = e.target.dataset.index;
                    contagens.splice(index, 1);
                    localStorage.setItem('minhasContagens', JSON.stringify(contagens));
                    renderContagens();
                }
            });

            limparMinhaContagemBtn.addEventListener('click', () => {
                modalText.textContent = "Deseja realmente limpar sua contagem?";
                modalAction = clearUserContagens;
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            });

            modalConfirmBtn.addEventListener('click', () => {
                if (modalAction) modalAction();
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            });

            modalCancelBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            });

            exportarContagemXlsxBtn.addEventListener('click', () => {
                if (contagens.length === 0) return;
                const dataToExport = contagens.map(item => ({
                    'Código': item.codigo,
                    'Nome do Produto': item.nomeProduto,
                    'Descrição': item.descricaoProduto,
                    'Localização': item.localizacao,
                    'Quantidade': item.quantidade
                }));
                const worksheet = XLSX.utils.json_to_sheet(dataToExport);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Contagem de Produtos');
                XLSX.writeFile(workbook, gerarNomeArquivo("xlsx"));
            });

            exportarContagemPdfBtn.addEventListener('click', () => {
                if (contagens.length === 0) return;
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const tableData = contagens.map(item => [item.codigo, item.nomeProduto, item.descricaoProduto, item.localizacao, item.quantidade]);
                doc.autoTable({ head: [['Código','Nome','Descrição','Localização','Qtd']], body: tableData });
                doc.save(gerarNomeArquivo("pdf"));
            });

            renderContagens();
        });
    </script>
</body>
</html>
